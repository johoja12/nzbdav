### Simulation: Automatic Repair of "1.HAPPY.FAMILY.USA.S01E02"

**Scenario:**
Plex fails to stream `1.HAPPY.FAMILY.USA.S01E02.1080p.AMZN.WEB-DL.DDP5.1.H.264-TURG.mkv` due to missing articles on Usenet. NzbDav's Health Check service detects this failure.

**The Dry Run Flow:**

1.  **Failure Detection:**
    *   **Event:** `UsenetArticleNotFoundException` triggered in NzbDav.
    *   **Target:** Virtual Item `1.HAPPY.FAMILY.USA.S01E02.1080p.AMZN.WEB-DL.DDP5.1.H.264-TURG.mkv`.

2.  **Path Resolution:**
    *   NzbDav resolves the physical path for the Arr apps:
    *   `path = /mnt/remote/nzbdav/completed-symlinks/sonarr/1.HAPPY.FAMILY.USA.S01E02.1080p.AMZN.WEB-DL.DDP5.1.H.264-TURG/1.HAPPY.FAMILY.USA.S01E02.1080p.AMZN.WEB-DL.DDP5.1.H.264-TURG.mkv`

3.  **Sonarr Handshake (The "Find" Step):**
    *   NzbDav calls `SonarrClient.RemoveAndSearch(path)`.
    *   **Step A (Find Series):** Queries `/api/v3/series`. Iterates series paths to find which one contains the file path.
        *   *Result:* Finds Series "1. Happy Family USA" (ID: `10`).
    *   **Step B (Find File):** Queries `/api/v3/episodefile?seriesId=10`. Matches exact file path.
        *   *Result:* Finds EpisodeFile ID `100` linked to that path.
    *   **Step C (Find Episode):** Queries `/api/v3/episode?episodeFileId=100`.
        *   *Result:* Finds Episode "S01E02" (ID: `500`).

4.  **Execution (The "Action" Step):**
    *   **Action 1 (Delete):** NzbDav calls `DELETE /api/v3/episodefile/100`.
        *   *Outcome:* Sonarr removes the file record and deletes the symlink from disk.
    *   **Action 2 (Search):** NzbDav calls `POST /api/v3/command { name: "EpisodeSearch", episodeIds: [500] }`.
        *   *Outcome:* Sonarr searches indexers for a new release of S01E02 (excluding the failed release if blocklisted).

5.  **Cleanup:**
    *   NzbDav removes the virtual item from its own database.
    *   NzbDav records a "Repaired/Deleted" event in the Health Check history.

**Conclusion:**
The logic works by relying on the **exact file path** being identical between NzbDav (who created it) and Sonarr (who imported it). NzbDav uses this shared path as the key to look up the metadata IDs inside Sonarr via API, enabling precision deletion and re-grabbing.
